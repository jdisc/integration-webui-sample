plugins {
  id "base"
  id "com.github.node-gradle.node" version "${nodePluginVersion}"
}

configurations {
  production
}

task deployForDev (type: Copy) {
  dependsOn ("npm_run_build")
  from ("dist/${project.name}")
  into "${project.buildDir}/META-INF/resources/"
}

task archiveForProd (type: Jar) {
  from ("dist/${project.name}") {
    into "META-INF/resources/"
  }
}

artifacts {
  archives archiveForProd
}

npm_run_build.finalizedBy deployForDev
npm_run_build.finalizedBy archiveForProd
build.dependsOn npm_run_build

clean {
  delete += "dist"
  delete += "node_modules"
  delete += "package-lock.json"
}
